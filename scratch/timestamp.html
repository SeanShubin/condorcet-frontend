<html>
<head>
    <title>timestamp</title>
    <style>
        .one-column {
            display: grid;
            grid-gap: 1rem;
            grid-template-columns: auto;
        }

        .two-columns {
            display: grid;
            grid-gap: 0.2rem;
            grid-template-columns: auto auto;
        }
    </style>
</head>
<body onload="bodyOnLoad()">
<div class="one-column">
    <input id="userInput" size="30" placeholder="YYYY-MM-DD HH:MM:SS" oninput="userInputChange()"
           onblur="userInputBlur()"/>
</div>
<div class="two-columns">
    <span>raw input</span><span id="rawInput"></span>
    <span>well formed input</span><span id="wellFormed"></span>
    <span>local date</span><span id="localDate"></span>
    <span>utc date</span><span id="utcDate"></span>
    <span>instant</span><span id="instant"></span>
</div>

<script type="text/javascript">
    const setText = (id, text) => {
        const element = document.getElementById(id)
        element.innerText = text
    }
    const createParser = text => {
        let index = 0
        const isDigit = ch => {
            if (ch < '0') return false
            if (ch > '9') return false
            return true
        }
        const consumeNonDigits = () => {
            while (index < text.length && !isDigit(text.charAt(index))) {
                index++
            }
        }
        const digitToNumber = digit => {
            return digit - '0'
        }
        const consumeDigits = max => {
            let accumulator = 0
            let remain = max
            while (index < text.length && isDigit(text.charAt(index)) && remain > 0) {
                const digit = text.charAt(index)
                index++
                remain--
                accumulator = accumulator * 10 + digitToNumber(digit)
            }
            return accumulator
        }
        const digits = howMany => {
            consumeNonDigits()
            return consumeDigits(howMany)
        }
        return {digits}
    }
    const createValidator = text => {
        const parser = createParser(text)
        const year = minMax(1900, 9999, parser.digits(4))
        const month = minMax(1, 12, parser.digits(2))
        const day = minMax(1, 31, parser.digits(2))
        const hour = minMax(0, 23, parser.digits(2))
        const minute = minMax(0, 59, parser.digits(2))
        const second = minMax(0, 59, parser.digits(2))
        const date = new Date(year, month - 1, day, hour, minute, second)
        const wellFormed = `${leadingZeroes(date.getFullYear(), 4)}-${leadingZeroes(date.getMonth() + 1, 2)}-${leadingZeroes(date.getDate(), 2)} ${leadingZeroes(date.getHours(), 2)}:${leadingZeroes(date.getMinutes(), 2)}:${leadingZeroes(date.getSeconds(), 2)}`
        const localDate = date.toString()
        const utcDate = date.toUTCString()
        const instant = date.toISOString()
        return {
            text, year, month, day, hour, minute, second, date, wellFormed, localDate, utcDate, instant
        }

    }
    const leadingZeroes = (number, length) => {
        let numberString = number.toString()
        let padding = '0'.repeat(length - numberString.length)
        return padding + numberString
    }
    const minMax = (min, max, actual) => {
        return Math.max(min, Math.min(max, actual))
    }
    const update = () => {
        const validator = createValidator(document.getElementById('userInput').value)
        setText('rawInput', validator.text)
        setText('wellFormed', validator.wellFormed)
        setText('localDate', validator.localDate)
        setText('utcDate', validator.utcDate)
        setText('instant', validator.instant)
    }
    const bodyOnLoad = () => {
        update()
    }
    const userInputChange = () => {
        update()
    }
    const userInputBlur = () => {
        const validator = createValidator(document.getElementById('userInput').value)
        const element = document.getElementById('userInput')
        element.value = validator.wellFormed
    }
</script>
</body>
</html>
